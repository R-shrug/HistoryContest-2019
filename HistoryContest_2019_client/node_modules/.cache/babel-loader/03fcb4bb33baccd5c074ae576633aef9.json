{"ast":null,"code":"var _jsxFileName = \"E:\\\\projects\\\\HistoryContest-2019\\\\historycontest2019\\\\src\\\\Components\\\\LoginModal\\\\LoginModal.js\";\nimport React from 'react';\nimport \"antd/dist/antd.css\";\nimport { Icon, Button, Input, Modal, message, Dropdown, Menu } from 'antd';\n\nclass LoginModal extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: true,\n      attemp: \"0\",\n      name: \"\",\n      username: '',\n      password: '',\n      toDo: \"登录\",\n      posted: false\n    };\n    this.ToLogin = this.ToLogin.bind(this);\n    this.close = this.close.bind(this);\n    this.signin = this.signin.bind(this);\n    this.ToSignin = this.ToSignin.bind(this);\n  }\n\n  ToLogin() {\n    this.setState({\n      posted: true\n    });\n    let that = this;\n    let username = this.state.username;\n    let password = this.state.password;\n    let identity = this.state.attemp;\n    console.log(\"login\");\n    message.success(\"登录成功！\"); //暂时的登陆函数\n\n    that.props.setState({\n      isWelcome: false,\n      isLogin: true,\n      isStudent: true,\n      isAllDone: false,\n      isAdmin: false,\n      isTeacher: false,\n      host: \"\",\n      userInfo: {\n        name: '菜鸡',\n        username: \"\",\n        token: '',\n        access: -1,\n        score: -1\n      },\n      answer: []\n    });\n    fetch('http://' + that.props.state.host + '/api/ui/login', {\n      method: 'POST',\n      mode: 'cors',\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n      },\n      body: JSON.stringify({\n        Username: username,\n        Password: password,\n        Identity: identity\n      })\n    }).then(async res => {\n      if (res.status == 404) {\n        message.error(\"学号不存在\");\n      } else if (res.status == 204) {\n        message.error(\"用户名或密码错误\");\n      } else {\n        //学生登陆成功\n        let data = await res.json();\n        this.setState({\n          posted: false\n        });\n        console.log(\"login\");\n        message.success(\"登录成功！\");\n\n        if (identity == \"0\") {\n          if (data.Score == -1) {\n            that.props.setState({\n              isWelcome: false,\n              isStudent: true,\n              isAllDone: false,\n              isLogin: true,\n              username: this.state.username,\n              userInfo: {\n                name: data.Name,\n                score: data.Score,\n                access: 0\n              }\n            });\n          } else {\n            that.props.setState({\n              isWelcome: false,\n              isStudent: true,\n              isAllDone: true,\n              isLogin: true,\n              username: this.state.username,\n              userInfo: {\n                name: data.Name,\n                score: data.Score,\n                access: 0\n              }\n            });\n          }\n        } else if (identity == \"2\") {\n          that.props.setState({\n            isWelcome: false,\n            isTeacher: true,\n            userInfo: {\n              access: 2\n            }\n          });\n        } else if (identity == \"1\") {\n          that.props.setState({\n            isWelcome: false,\n            isAdmin: true,\n            userInfo: {\n              access: 1\n            }\n          });\n        }\n      }\n    });\n  }\n\n  ToSignin() {\n    //暂时的注册函数\n    this.props.setState({\n      isWelcome: false,\n      isStudent: true,\n      isLogin: true\n    });\n  }\n\n  close() {\n    this.setState({\n      visible: false\n    });\n    this.props.close();\n  }\n\n  signin() {\n    this.setState({\n      toDo: \"注册\"\n    });\n  }\n\n  render() {\n    let login = React.createElement(\"div\", {\n      id: \"modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, React.createElement(Modal, {\n      title: React.createElement(Dropdown, {\n        overlay: React.createElement(Menu, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149\n          },\n          __self: this\n        }, React.createElement(Menu.Item, {\n          key: \"1\",\n          onClick: () => this.setState({\n            attemp: \"0\"\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        }, \"\\u5B66\\u751F\"), React.createElement(Menu.Item, {\n          key: \"2\",\n          onClick: () => this.setState({\n            attemp: \"2\"\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, \"\\u8F85\\u5BFC\\u5458\"), React.createElement(Menu.Item, {\n          key: \"3\",\n          onClick: () => this.setState({\n            attemp: \"1\"\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, \"\\u7BA1\\u7406\\u5458\")),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"defult\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        type: \"down\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }), this.state.attemp == 0 && \"学生\", this.state.attemp == 2 && \"辅导员\", this.state.attemp == 1 && \"管理员\")),\n      visible: this.state.visible,\n      onOk: this.StudentToLogin,\n      onCancel: this.close,\n      footer: [React.createElement(Button, {\n        key: \"\\u8FD4\\u56DE\",\n        type: \"defult\",\n        onClick: this.close,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, \"\\u8FD4\\u56DE\"), React.createElement(Button, {\n        key: \"\\u767B\\u5F55\",\n        type: \"primary\",\n        onClick: this.ToLogin,\n        loading: this.state.posted,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        type: \"check-circle\",\n        theme: \"twoTone\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }), \"\\u767B\\u5F55\")],\n      visible: this.state.visible,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: \"username\",\n      addonBefore: \" \\u8D26\\u6237 \",\n      placeholder: this.state.attemp == \"0\" ? \"八位学号\" : \"管理员账户\",\n      allowClear: true,\n      onChange: (x, v) => {\n        this.setState({\n          username: v\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }), React.createElement(Input.Password, {\n      id: \"password\",\n      addonBefore: \" \\u5BC6\\u7801 \",\n      placeholder: this.state.attemp == \"0\" ? \"一卡通号码\" : \"管理员密码\",\n      allowClear: true,\n      onChange: (x, v) => {\n        this.setState({\n          password: v\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }), React.createElement(\"a\", {\n      onClick: () => {\n        this.setState({\n          attemp: \"1\",\n          toDo: \"注册\"\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }, \"\\xA0\\xA0\\u6CA1\\u6709\\u8D26\\u53F7?\"))));\n    let sign = React.createElement(\"div\", {\n      id: \"modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }, React.createElement(Modal, {\n      title: \"\\u6CE8\\u518C\\u9700\\u7BA1\\u7406\\u5458\\u767B\\u5F55\",\n      visible: this.state.visible,\n      onOk: this.StudentToLogin,\n      onCancel: this.close,\n      footer: [React.createElement(Button, {\n        key: \"\\u8FD4\\u56DE\",\n        type: \"defult\",\n        onClick: this.close,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, \"\\u8FD4\\u56DE\"), React.createElement(Button, {\n        key: \"\\u6CE8\\u518C\",\n        type: \"primary\",\n        onClick: this.ToLogin,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, \"\\u767B\\u5F55\")],\n      visible: this.state.visible,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, React.createElement(Input, {\n      id: \"username\",\n      addonBefore: \" \\u8D26\\u6237 \",\n      placeholder: \"\\u7BA1\\u7406\\u5458\\u8D26\\u6237\",\n      allowClear: true,\n      onChange: (x, v) => {\n        this.setState({\n          username: v\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }), React.createElement(Input.Password, {\n      id: \"password\",\n      addonBefore: \" \\u5BC6\\u7801 \",\n      placeholder: \"\\u7BA1\\u7406\\u5458\\u5BC6\\u7801\",\n      allowClear: true,\n      onChange: (x, v) => {\n        this.setState({\n          password: v\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, \" \"), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    })));\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, this.state.toDo == \"登录\" ? login : sign);\n  }\n\n}\n\nexport default LoginModal;","map":{"version":3,"sources":["E:\\projects\\HistoryContest-2019\\historycontest2019\\src\\Components\\LoginModal\\LoginModal.js"],"names":["React","Icon","Button","Input","Modal","message","Dropdown","Menu","LoginModal","Component","constructor","props","state","visible","attemp","name","username","password","toDo","posted","ToLogin","bind","close","signin","ToSignin","setState","that","identity","console","log","success","isWelcome","isLogin","isStudent","isAllDone","isAdmin","isTeacher","host","userInfo","token","access","score","answer","fetch","method","mode","headers","body","JSON","stringify","Username","Password","Identity","then","res","status","error","data","json","Score","Name","render","login","StudentToLogin","x","v","sign"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport \"antd/dist/antd.css\"\r\nimport { Icon, Button, Input, Modal, message, Dropdown, Menu } from 'antd';\r\n\r\nclass LoginModal extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            visible: true,\r\n            attemp: \"0\",\r\n            name: \"\",\r\n            username: '',\r\n            password: '',\r\n            toDo: \"登录\",\r\n            posted: false\r\n        }\r\n        this.ToLogin = this.ToLogin.bind(this);\r\n        this.close = this.close.bind(this);\r\n        this.signin = this.signin.bind(this);\r\n        this.ToSignin = this.ToSignin.bind(this);\r\n    }\r\n    ToLogin() {\r\n        this.setState({ posted: true })\r\n        let that = this;\r\n        let username = this.state.username;\r\n        let password = this.state.password;\r\n        let identity = this.state.attemp;\r\n\r\n\r\n        console.log(\"login\");\r\n        message.success(\"登录成功！\");\r\n\r\n        //暂时的登陆函数\r\n        that.props.setState({\r\n            isWelcome: false,\r\n            isLogin: true,\r\n            isStudent: true,\r\n            isAllDone: false,\r\n            isAdmin: false,\r\n            isTeacher: false,\r\n            host: \"\",\r\n            userInfo:\r\n            {\r\n                name: '菜鸡',\r\n                username: \"\",\r\n                token: '',\r\n                access: -1,\r\n                score: -1\r\n            },\r\n            answer: []\r\n        })\r\n\r\n\r\n\r\n        fetch('http://' + that.props.state.host + '/api/ui/login', {\r\n            method: 'POST',\r\n            mode: 'cors',\r\n            headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n            },\r\n            body: JSON.stringify({\r\n                Username: username,\r\n                Password: password,\r\n                Identity: identity\r\n            })\r\n        }).then(\r\n            async res => {\r\n                if (res.status == 404) {\r\n                    message.error(\"学号不存在\");\r\n                }\r\n                else if (res.status == 204) {\r\n                    message.error(\"用户名或密码错误\");\r\n                }\r\n                else {\r\n                    //学生登陆成功\r\n                    let data = await res.json();\r\n                    this.setState({ posted: false })\r\n                    console.log(\"login\");\r\n                    message.success(\"登录成功！\");\r\n                    if (identity == \"0\") {\r\n                        if (data.Score == -1) {\r\n                            that.props.setState({\r\n                                isWelcome: false,\r\n                                isStudent: true,\r\n                                isAllDone: false,\r\n                                isLogin: true,\r\n                                username: this.state.username,\r\n                                userInfo: {\r\n                                    name: data.Name,\r\n                                    score: data.Score,\r\n                                    access: 0\r\n                                }\r\n                            });\r\n                        }\r\n                        else {\r\n                            that.props.setState({\r\n                                isWelcome: false,\r\n                                isStudent: true,\r\n                                isAllDone: true,\r\n                                isLogin: true,\r\n                                username: this.state.username,\r\n                                userInfo: {\r\n                                    name: data.Name,\r\n                                    score: data.Score,\r\n                                    access: 0\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                    else if (identity == \"2\") {\r\n                        that.props.setState({\r\n                            isWelcome: false,\r\n                            isTeacher: true,\r\n                            userInfo: {\r\n                                access: 2\r\n                            }\r\n                        })\r\n                    }\r\n                    else if (identity == \"1\") {\r\n                        that.props.setState({\r\n                            isWelcome: false,\r\n                            isAdmin: true,\r\n                            userInfo: {\r\n                                access: 1\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n            })\r\n\r\n\r\n    }\r\n    ToSignin() {\r\n        //暂时的注册函数\r\n        this.props.setState({ isWelcome: false, isStudent: true, isLogin: true });\r\n    }\r\n    close() {\r\n        this.setState({ visible: false });\r\n        this.props.close();\r\n    }\r\n    signin() {\r\n        this.setState({ toDo: \"注册\" });\r\n    }\r\n    render() {\r\n        let login = <div id='modal'>\r\n            <Modal\r\n                title={\r\n                    <Dropdown overlay={\r\n                        <Menu>\r\n                            <Menu.Item key=\"1\" onClick={() => this.setState({ attemp: \"0\" })}>学生</Menu.Item>\r\n                            <Menu.Item key=\"2\" onClick={() => this.setState({ attemp: \"2\" })}>辅导员</Menu.Item>\r\n                            <Menu.Item key=\"3\" onClick={() => this.setState({ attemp: \"1\" })}>管理员</Menu.Item>\r\n                        </Menu >}>\r\n                        <Button type=\"defult\">\r\n                            <Icon type=\"down\" />\r\n                            {this.state.attemp == 0 && \"学生\"}\r\n                            {this.state.attemp == 2 && \"辅导员\"}\r\n                            {this.state.attemp == 1 && \"管理员\"}\r\n                        </Button>\r\n                    </Dropdown>}\r\n                visible={this.state.visible}\r\n                onOk={this.StudentToLogin}\r\n                onCancel={this.close}\r\n                footer={[\r\n                    <Button key=\"返回\" type=\"defult\" onClick={this.close}>\r\n                        返回\r\n              </Button>,\r\n                    <Button key=\"登录\" type=\"primary\" onClick={this.ToLogin} loading={this.state.posted}>\r\n                        <Icon type=\"check-circle\" theme=\"twoTone\" />\r\n                        登录\r\n              </Button>\r\n                ]}\r\n                visible={this.state.visible}>\r\n                <Input id=\"username\" addonBefore=\" 账户 \" placeholder={this.state.attemp==\"0\"?\"八位学号\":\"管理员账户\"} allowClear onChange={(x, v) => { this.setState({ username: v }) }}></Input>\r\n                <p></p>\r\n                <Input.Password id=\"password\" addonBefore=\" 密码 \" placeholder={this.state.attemp==\"0\"?\"一卡通号码\":\"管理员密码\"} allowClear onChange={(x, v) => { this.setState({ password: v }) }} />\r\n                <p > <br></br>\r\n                    <a onClick={()=>{this.setState({attemp:\"1\",toDo:\"注册\"})}}>\r\n                        &nbsp;&nbsp;没有账号?\r\n                    </a>\r\n                </p>\r\n\r\n            </Modal>\r\n        </div>\r\n\r\n        let sign = <div id='modal'>\r\n            <Modal\r\n                title=\"注册需管理员登录\"\r\n                visible={this.state.visible}\r\n                onOk={this.StudentToLogin}\r\n                onCancel={this.close}\r\n                footer={[\r\n                    <Button key=\"返回\" type=\"defult\" onClick={this.close}>\r\n                        返回\r\n              </Button>,\r\n                    <Button key=\"注册\" type=\"primary\" onClick={this.ToLogin}>\r\n                        登录\r\n              </Button>\r\n                ]}\r\n                visible={this.state.visible}\r\n            >\r\n                <Input id=\"username\" addonBefore=\" 账户 \" placeholder=\"管理员账户\" allowClear onChange={(x, v) => { this.setState({ username: v }) }}></Input>\r\n                <p></p>\r\n                <Input.Password id=\"password\" addonBefore=\" 密码 \" placeholder=\"管理员密码\" allowClear onChange={(x, v) => { this.setState({ password: v }) }} />\r\n                <p> </p><br></br>\r\n            </Modal>\r\n        </div>\r\n        return (\r\n            <React.Fragment>\r\n                {this.state.toDo == \"登录\" ? login : sign}\r\n            </React.Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nexport default LoginModal;"]},"metadata":{},"sourceType":"module"}